---
title: "Assignment 4: Mini Exploratory Report"
author: "Will Geiken"
date: "11/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(lubridate)
library(kableExtra)
library(janitor)
library(here)
library(ggbeeswarm)
library(effsize)
library(broom)
library(tidyverse)

bonanza_hares <- read.csv(here("data", "bonanza_hares.csv"))
```

## Introduction

## Data and Analysis

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14 (Accessed 2020-11-13).

Bonanza Riparian is a flood zone along the Tanana River and Bonanza Mature is a mature black spruce forest approximately 1 km inland from the river and 2 km from the riparian plot. Bonbs Site used for live-trapping snowshoe hares to monitor abundance and survival. Located in a mature lowland black spruce stand.

## Exploratory Findings

#### Annual Juvenile Hare Trap Counts

```{r, include=FALSE}
juvenile_counts <- bonanza_hares %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date)) %>% 
  filter(age == "j")

count_by_year <- juvenile_counts %>%
  count(year)%>% 
  complete(year = 1998:2012, fill = list(n = 0))

# 1999 had 126 counts, 1998, 2002 and 2009 had 0, next lowest was 2 in 2010

total_hares <- sum(count_by_year$n)
#378 total juvenile hares

mean_hares <- mean(count_by_year$n)
#mean hares over 15 years = 25.2 hares/year

sd_hares <- sd(count_by_year$n)
#sd = 34.379, very high

```

```{r, echo = FALSE, results = TRUE, fig.cap = "Total annual counts of juvenile hare catches across all collection sites from 1998-2012"}
ggplot(data = juvenile_counts, aes(x = year)) +
  geom_bar(fill = "darkred") +
  theme_linedraw() +
  labs(x = "Year",
       y = "Juvenile Hare Count")
```

###### Major Takeaways

The year with the highest count of juvenile hares was 1999 with 126 juveniles counted, while the lowest were 1998, 2002, and 2009 each with 0 juveniles counted. Proceeding from 1999, the number of juvenile catches declined during the first few years and then oscillated for the remaining years. The mean annual juvenile catch was `r (mean_hares)`, but that value belies the high year-to-year variation. Additionally, these values do not take into account the number of days spent trapping per year, the number of traps per site, and other statistics relevant to effort. If data collection continues, it would help to standardize data collection effort to avoid biasing trap counts for certain years or at certain sites. No responsible conclusive statements about annual variation can be drawn from the data as they exist.

#### Visualize Juvenile Hare Weights

```{r, include=FALSE}
library(ggbeeswarm)

juvenile_weights <- bonanza_hares %>% 
  select(weight, sex, grid)

weights_summary_bonbs <- juvenile_weights %>% 
  filter(grid == "bonbs") %>% 
  group_by(sex) %>% 
  summarize(bonbs_mean_weight = mean(weight, na.rm = TRUE))

weights_summary_bonmat <- juvenile_weights %>% 
  filter(grid == "bonmat") %>% 
  group_by(sex) %>% 
  summarize(bonmat_mean_weight = mean(weight, na.rm = TRUE))
  
weights_summary_bonrip <- juvenile_weights %>% 
  filter(grid == "bonrip") %>%   
  group_by(sex) %>% 
  summarize(bonrip_mean_weight = mean(weight, na.rm = TRUE))
  
```


```{r, echo = FALSE, warning = FALSE, results = TRUE, fig.cap = "Juvenile hare weight distributions by sex at three collection sites: 'bonbs', 'bonmat', and 'bonrip'. Boxplots display the mean weight for each population, one standard deviation, and a 95% confidence interval."}
ggplot(data = juvenile_weights,
                aes(x = sex,
                    y = weight,
                    fill = sex)) +
  geom_violin() +
  geom_boxplot(width = 0.3, color = "black") +
  facet_wrap(~grid) +
  theme_linedraw() +
  labs(
    x = "Sex",
    y = "Weight (g)"
  ) +
  scale_fill_brewer(palette = "Dark2")
```

###### Major Takeaways

Wide spread in weights, no major tendency for one sex to be larger than the other, lots of low-outliers.

#### Juvenile weight comparison

```{r, include=FALSE}
juvenile_sex_counts <- bonanza_hares %>% 
  filter(age == "j") %>% 
  select(weight, sex) %>%
  na.omit()  #gets rid of NA values so they don't throw off the means etc.
  
#histogram
ggplot(data = juvenile_sex_counts, aes(x = weight)) +
  geom_histogram(bins = 10) +
  facet_wrap(~sex)
# looks more or less normally distributed, but the male data concerns me a little
  
#QQ plot
ggplot(data = juvenile_sex_counts, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex) 
#the female data looks fairly linear, but the male data seems non-linear
 
#t-test
hares_f <- juvenile_sex_counts %>% 
  filter(sex == "f") %>% 
  pull(weight)

hares_m <- juvenile_sex_counts %>% 
  filter(sex == "m") %>% 
  pull(weight)

hares_ttest <- t.test(hares_f, hares_m)

hares_ttest #gives a p-value of 0.007093

cohen.d(hares_f, hares_m)
#gives a cohen's d of -0.2904674, which is small, so the effect size is small

```

```{r, echo = FALSE, warning = FALSE, message = FALSE, results = TRUE}
juvenile_statistics <- juvenile_sex_counts %>% 
  group_by(sex) %>%
  summarize("Mean weight" = mean(weight),
            "Standard deviation" = sd(weight),
            "Sample size" = n())


  kable(juvenile_statistics,
      caption = "WRITE A CAPTION WILL") %>% 
  kable_styling()
```

###### Major Takeaways

Cohen's d is small (-0.26), p-value is small 0.0071, which suggests there is a significant difference, however, given the sample sizes that isn't surprising. The overall effect is so small that I blah nothing too concrete.

#### Relationship between juvenile weight and hind foot length

```{r, echo = FALSE, warning = FALSE, results = TRUE, fig.cap = "Juvenile"}
juvenile_hndft <- bonanza_hares %>% 
  filter(age == "j") %>% 
  select(age, weight, hindft)

ggplot(data = juvenile_hndft, aes(x = hindft, y = weight)) +
  geom_point() +
  labs( y = "Weight (g)",
        x = "Hind foot length (units = ?)")

hare_lm <- lm( weight ~ hindft, data = juvenile_hndft)

summary(hare_lm)

hare_lm_tidy <- broom::tidy(hare_lm)

#write output

#check assumptions

plot(hare_lm)

#definite uneven spread in residual, curve in qq plot, data close to Cook's distance. It is not responsible to run a regression.
```


## Summary

## Citations